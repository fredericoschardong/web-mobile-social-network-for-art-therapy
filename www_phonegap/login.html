<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <link rel="stylesheet" type="text/css" href="css/jquery.css" />
        
    	<script type="text/javascript" src="cordova-2.5.0.js"></script>
    	<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
    	<script type="text/javascript" src="js/jquery.mobile-1.2.0.min.js"></script>
    	<script type="text/javascript" src="js/jquery.validate.min.js"></script>
    	<script type="text/javascript" src="js/jquery-blockui.js"></script>
    	<script type="text/javascript" src="js/index.js"></script>
    	
        <title>Cool App</title>
    </head>
    <body>
        <div data-role="page" id="page1">
            <div data-theme="a" data-role="header">
                <h3>
                    Cool App
                </h3>
            </div>
            <form id="frmLogin">
	            <div data-role="content" id="content">
	                <div data-role="fieldcontain">
	                    <label for="username">
	                        Username
	                    </label>
	                    <input id="username" name="username" type="text" class="required" value="123"/>
	                </div>
	                
	                <div data-role="fieldcontain">
	                    <label for="password">
	                        Password	
	                    </label>
	                    <input id="password" name="password" type="password" class="required" value="123"/>
	                </div>
	                
	                <div data-role="fieldcontain">
	                    <label for="password">
	                        Server	
	                    </label>
	                    <input id="server" name="server" type="text" class="required" value="136.159.195.189"/>
	                </div>
	                
	                <a id="login" data-role="button" class="login">
	                    Login
	                </a>
	            </div>
            </form>
        </div>
        
        <script>
        	function onDeviceReady(){
	        	$('#login').click(function(){
	        		window.localStorage.setItem("server", $('#server').val());
	        		
	        		if($("form").valid()){
		        		$.ajax({
							url: "http://" + window.localStorage.getItem("server") +"/users/logout",
							type: "POST"
						}).always(function(){
							$.ajax({
								url: "http://" + window.localStorage.getItem("server") +"/users/login",
								type: "POST",
								data: { 'data[User][username]': $('#username').val(), 
										'data[User][password]': $('#password').val(),
										mobile: 'true'
									  }
							}).done(function(msg) {
								if(msg != 'ok'){
									alert("Wrong username or password");
								}
								else{
									console.log(msg);
									window.localStorage.setItem("username", $('#username').val());
									window.localStorage.setItem("password", $('#password').val());
									
									//$.mobile.changePage("home.html");
									window.location.href = "home.html";
								}
							}).fail(function(msg){
								alert("Some error has occurred, are you connected to the internet?");
								
								console.log(msg.statusCode());
							});
			        	});
		        	}
		        });
	       }
        </script>
    </body>
</html>
